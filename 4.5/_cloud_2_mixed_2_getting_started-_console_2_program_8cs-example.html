<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees IP Intelligence .NET: Cloud/Mixed/GettingStarted-Console/Program.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="/documentation/4.5/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees IP Intelligence .NET
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">IP intelligence services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_cloud_2_mixed_2_getting_started-_console_2_program_8cs-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">Cloud/Mixed/GettingStarted-Console/Program.cs</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>This example demonstrates using both Device Detection and IP Intelligence from the 51Degrees Cloud service.You will learn:</p>
<ol type="1">
<li>How to create a Pipeline that uses both 51Degrees Cloud Device Detection and IP Intelligence</li>
<li>How to pass input data (User-Agent and IP address) to the Pipeline</li>
<li>How to retrieve device and IP intelligence results from a single pipeline</li>
</ol>
<p>This example is available in full on <a href="https://github.com/51Degrees/ip-intelligence-dotnet-examples/blob/main/Examples/Cloud/Mixed/GettingStarted-Console/Program.cs">GitHub</a>.</p>
<p>To run this example, you will eventually need to create a Resource Key, but for now you should use the GettingStarted-API example - just run it and point this example to its custom endpoint to simulate a custom hosted Cloud service. Resource Key is used as shorthand to store the particular set of properties you are interested in as well as any associated License Keys that entitle you to increased request limits and/or paid-for properties, but it is not yet available for IP Intelligence.</p>
<p>Required NuGet Dependencies:</p><ul>
<li><a href="https://www.nuget.org/packages/FiftyOne.IpIntelligence/">FiftyOne.IpIntelligence</a></li>
<li><a href="https://www.nuget.org/packages/Microsoft.Extensions.Configuration.Json/">Microsoft.Extensions.Configuration.Json</a></li>
<li><a href="https://www.nuget.org/packages/Microsoft.Extensions.DependencyInjection/">Microsoft.Extensions.DependencyInjection</a></li>
<li><a href="https://www.nuget.org/packages/Microsoft.Extensions.Logging.Console/">Microsoft.Extensions.Logging.Console</a> </li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence.html">IpIntelligence</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_cloud.html">Cloud</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_cloud_1_1_flow_elements.html">FlowElements</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.CloudRequestEngine.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Configuration;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Engines.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Engines.FiftyOne.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Configuration;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.DependencyInjection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Logging;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Collections.Generic;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.IO;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Linq;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Net.Http;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Text;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.DeviceDetection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.DeviceDetection.Cloud.FlowElements;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_cloud_1_1_mixed_1_1_getting_started_console.html">FiftyOne.IpIntelligence.Examples.Cloud.Mixed.GettingStartedConsole</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Program</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Example</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> Run(IServiceProvider serviceProvider, TextWriter output)</div><div class="c-code__line">            {</div><div class="c-code__line">                var pipelineOptions = serviceProvider.GetRequiredService&lt;PipelineOptions&gt;();</div><div class="c-code__line">                var loggerFactory = serviceProvider.GetRequiredService&lt;ILoggerFactory&gt;();</div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__comment">// In this example, we use the FiftyOnePipelineBuilder and configure it from a file.</span></div><div class="c-code__line">                <span class="c-code__comment">// For more information about builders in general see the documentation at</span></div><div class="c-code__line">                <span class="c-code__comment">// https://51degrees.com/documentation/_concepts__configuration__builders__index.html</span></div><div class="c-code__line"></div><div class="c-code__line">                <span class="c-code__comment">// Create the pipeline using the service provider and the configured options.</span></div><div class="c-code__line">                <span class="c-code__keyword">using</span> (var pipeline = <span class="c-code__keyword">new</span> FiftyOnePipelineBuilder(loggerFactory, serviceProvider)</div><div class="c-code__line">                    .BuildFromConfiguration(pipelineOptions))</div><div class="c-code__line">                {</div><div class="c-code__line">                    <span class="c-code__comment">// Carry out some sample detections</span></div><div class="c-code__line">                    <span class="c-code__keywordflow">foreach</span> (var values <span class="c-code__keywordflow">in</span> CombinedEvidence)</div><div class="c-code__line">                    {</div><div class="c-code__line">                        AnalyseEvidence(values, pipeline, output);</div><div class="c-code__line">                    }</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keyword">static</span> readonly List&lt;Dictionary&lt;string, object&gt;&gt; CombinedEvidence =</div><div class="c-code__line">            [</div><div class="c-code__line">                <span class="c-code__comment">// Mobile device from China</span></div><div class="c-code__line">                <span class="c-code__keyword">new</span>()</div><div class="c-code__line">                {</div><div class="c-code__line">                    {</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;header.user-agent&quot;</span>,</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Mobile/15E148 Safari/604.1&quot;</span> </div><div class="c-code__line">                    },</div><div class="c-code__line">                    { <span class="c-code__stringliteral">&quot;query.client-ip&quot;</span>, <span class="c-code__stringliteral">&quot;62.61.32.31&quot;</span> }</div><div class="c-code__line">                },</div><div class="c-code__line">                <span class="c-code__comment">// Desktop from Chile</span></div><div class="c-code__line">                <span class="c-code__keyword">new</span>()</div><div class="c-code__line">                {</div><div class="c-code__line">                    {</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;header.user-agent&quot;</span>,</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&quot;</span></div><div class="c-code__line">                    },</div><div class="c-code__line">                    { <span class="c-code__stringliteral">&quot;query.client-ip&quot;</span>, <span class="c-code__stringliteral">&quot;45.236.48.61&quot;</span> }</div><div class="c-code__line">                },</div><div class="c-code__line">                <span class="c-code__comment">// Tablet with IPv6</span></div><div class="c-code__line">                <span class="c-code__keyword">new</span>()</div><div class="c-code__line">                {</div><div class="c-code__line">                    {</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;header.user-agent&quot;</span>,</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;Mozilla/5.0 (iPad; CPU OS 14_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/91.0.4472.80 Mobile/15E148 Safari/604.1&quot;</span></div><div class="c-code__line">                    },</div><div class="c-code__line">                    { <span class="c-code__stringliteral">&quot;query.client-ip&quot;</span>, <span class="c-code__stringliteral">&quot;2001:0db8:085a:0000:0000:8a2e:0370:7334&quot;</span> }</div><div class="c-code__line">                },</div><div class="c-code__line">                <span class="c-code__comment">// Android device from USA</span></div><div class="c-code__line">                <span class="c-code__keyword">new</span>()</div><div class="c-code__line">                {</div><div class="c-code__line">                    {</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;header.user-agent&quot;</span>,</div><div class="c-code__line">                        <span class="c-code__stringliteral">&quot;Mozilla/5.0 (Linux; Android 11; SM-G973F) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.120 Mobile Safari/537.36&quot;</span></div><div class="c-code__line">                    },</div><div class="c-code__line">                    { <span class="c-code__stringliteral">&quot;query.client-ip&quot;</span>, <span class="c-code__stringliteral">&quot;8.8.8.8&quot;</span> }</div><div class="c-code__line">                },</div><div class="c-code__line">            ];</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> AnalyseEvidence(</div><div class="c-code__line">                Dictionary&lt;string, object&gt; evidence,</div><div class="c-code__line">                IPipeline pipeline, </div><div class="c-code__line">                TextWriter output)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// FlowData is used to convey information through the pipeline</span></div><div class="c-code__line">                <span class="c-code__keyword">using</span> (var data = pipeline.CreateFlowData())</div><div class="c-code__line">                {</div><div class="c-code__line">                    StringBuilder message = <span class="c-code__keyword">new</span> StringBuilder();</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// List the evidence</span></div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;=&quot;</span> + <span class="c-code__keyword">new</span> <span class="c-code__keywordtype">string</span>(<span class="c-code__charliteral">&#39;=&#39;</span>, 78));</div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;Input values:&quot;</span>);</div><div class="c-code__line">                    <span class="c-code__keywordflow">foreach</span> (var entry <span class="c-code__keywordflow">in</span> evidence)</div><div class="c-code__line">                    {</div><div class="c-code__line">                        message.AppendLine($<span class="c-code__stringliteral">&quot;\t{entry.Key}: {entry.Value}&quot;</span>);</div><div class="c-code__line">                    }</div><div class="c-code__line">                    output.WriteLine(message.ToString());</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// Add the evidence values to the flow data</span></div><div class="c-code__line">                    data.AddEvidence(evidence);</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// Process the flow data - both engines will run in parallel</span></div><div class="c-code__line">                    data.Process();</div><div class="c-code__line"></div><div class="c-code__line">                    message = <span class="c-code__keyword">new</span> StringBuilder();</div><div class="c-code__line">                    </div><div class="c-code__line">                    <span class="c-code__comment">// Get Device Detection results</span></div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;\nDevice Detection Results:&quot;</span>);</div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;-&quot;</span> + <span class="c-code__keyword">new</span> <span class="c-code__keywordtype">string</span>(<span class="c-code__charliteral">&#39;-&#39;</span>, 24));</div><div class="c-code__line">                    var device = data.Get&lt;IDeviceData&gt;();</div><div class="c-code__line">                    OutputDeviceData(device, message);</div><div class="c-code__line">                    </div><div class="c-code__line">                    <span class="c-code__comment">// Get IP Intelligence results</span></div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;\nIP Intelligence Results:&quot;</span>);</div><div class="c-code__line">                    message.AppendLine(<span class="c-code__stringliteral">&quot;-&quot;</span> + <span class="c-code__keyword">new</span> <span class="c-code__keywordtype">string</span>(<span class="c-code__charliteral">&#39;-&#39;</span>, 23));</div><div class="c-code__line">                    var ipData = data.Get&lt;IIpIntelligenceData&gt;();</div><div class="c-code__line">                    OutputIpData(ipData, message);</div><div class="c-code__line">                    </div><div class="c-code__line">                    output.WriteLine(message.ToString());</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputDeviceData(IDeviceData device, StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Mobile Device&quot;</span>, device.IsMobile, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Platform Name&quot;</span>, device.PlatformName, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Platform Version&quot;</span>, device.PlatformVersion, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Browser Name&quot;</span>, device.BrowserName, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Browser Version&quot;</span>, device.BrowserVersion, message);</div><div class="c-code__line">                OutputListValue(<span class="c-code__stringliteral">&quot;Hardware Name&quot;</span>, device.HardwareName, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Hardware Vendor&quot;</span>, device.HardwareVendor, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Device Type&quot;</span>, device.DeviceType, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Screen Width&quot;</span>, device.ScreenPixelsWidth, message);</div><div class="c-code__line">                OutputValue(<span class="c-code__stringliteral">&quot;Screen Height&quot;</span>, device.ScreenPixelsHeight, message);</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputIpData(IIpIntelligenceData ipData, StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;Country&quot;</span>, ipData.Country, message);</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;Country Code&quot;</span>, ipData.CountryCode, message);</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;Region&quot;</span>, ipData.Region, message);</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;State&quot;</span>, ipData.State, message);</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;Town&quot;</span>, ipData.Town, message);</div><div class="c-code__line">                OutputWeightedFloatValues(<span class="c-code__stringliteral">&quot;Latitude&quot;</span>, ipData.Latitude, message);</div><div class="c-code__line">                OutputWeightedFloatValues(<span class="c-code__stringliteral">&quot;Longitude&quot;</span>, ipData.Longitude, message);</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;Registered Name&quot;</span>, ipData.RegisteredName, message);</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;Registered Owner&quot;</span>, ipData.RegisteredOwner, message);</div><div class="c-code__line">                OutputWeightedStringProperty(<span class="c-code__stringliteral">&quot;Registered Country&quot;</span>, ipData.RegisteredCountry, message);</div><div class="c-code__line">                OutputWeightedIPAddressValues(<span class="c-code__stringliteral">&quot;IP Range Start&quot;</span>, ipData.IpRangeStart, message);</div><div class="c-code__line">                OutputWeightedIPAddressValues(<span class="c-code__stringliteral">&quot;IP Range End&quot;</span>, ipData.IpRangeEnd, message);</div><div class="c-code__line">                OutputWeightedIntValues(<span class="c-code__stringliteral">&quot;Accuracy Radius&quot;</span>, ipData.AccuracyRadiusMin, message);</div><div class="c-code__line">                OutputWeightedIntValues(<span class="c-code__stringliteral">&quot;Time Zone Offset&quot;</span>, ipData.TimeZoneOffset, message);</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputValue(<span class="c-code__keywordtype">string</span> name, </div><div class="c-code__line">                IAspectPropertyValue value,</div><div class="c-code__line">                StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                message.AppendLine(value.HasValue ?</div><div class="c-code__line">                    $<span class="c-code__stringliteral">&quot;\t{name}: {value.Value}&quot;</span> :</div><div class="c-code__line">                    $<span class="c-code__stringliteral">&quot;\t{name}: {value.NoValueMessage}&quot;</span>);</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputListValue(<span class="c-code__keywordtype">string</span> name,</div><div class="c-code__line">                IAspectPropertyValue&lt;IReadOnlyList&lt;string&gt;&gt; property,</div><div class="c-code__line">                StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> (!property.HasValue)</div><div class="c-code__line">                {</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {property.NoValueMessage}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                {</div><div class="c-code__line">                    var values = <span class="c-code__keywordtype">string</span>.Join(<span class="c-code__stringliteral">&quot;, &quot;</span>, property.Value.Select(v =&gt; $<span class="c-code__stringliteral">&quot;&#39;{v}&#39;&quot;</span>));</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {values}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputWeightedStringProperty(<span class="c-code__keywordtype">string</span> name, </div><div class="c-code__line">                IAspectPropertyValue&lt;IReadOnlyList&lt;IWeightedValue&lt;string&gt;&gt;&gt; property,</div><div class="c-code__line">                StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> (!property.HasValue)</div><div class="c-code__line">                {</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {property.NoValueMessage}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                {</div><div class="c-code__line">                    var values = <span class="c-code__keywordtype">string</span>.Join(<span class="c-code__stringliteral">&quot;, &quot;</span>, property.Value.Select(x =&gt; </div><div class="c-code__line">                        x.Weighting() == 1 ? $<span class="c-code__stringliteral">&quot;&#39;{x.Value}&#39;&quot;</span> : $<span class="c-code__stringliteral">&quot;(&#39;{x.Value}&#39; @ {x.Weighting()})&quot;</span>));</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {values}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputWeightedIntValues(<span class="c-code__keywordtype">string</span> name, </div><div class="c-code__line">                IAspectPropertyValue&lt;IReadOnlyList&lt;IWeightedValue&lt;int&gt;&gt;&gt; property,</div><div class="c-code__line">                StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> (!property.HasValue)</div><div class="c-code__line">                {</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {property.NoValueMessage}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                {</div><div class="c-code__line">                    var values = <span class="c-code__keyword">property</span>.Value.Select(x =&gt; </div><div class="c-code__line">                        Math.Abs(x.Weighting() - 1.0f) &lt; 0.0001f ? x.Value.ToString() : $<span class="c-code__stringliteral">&quot;({x.Value} @ {x.Weighting():F4})&quot;</span>);</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {string.Join(&quot;</span>, <span class="c-code__stringliteral">&quot;, values)}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputWeightedFloatValues(<span class="c-code__keywordtype">string</span> name, </div><div class="c-code__line">                IAspectPropertyValue&lt;IReadOnlyList&lt;IWeightedValue&lt;float&gt;&gt;&gt; property,</div><div class="c-code__line">                StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> (!property.HasValue)</div><div class="c-code__line">                {</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {property.NoValueMessage}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                {</div><div class="c-code__line">                    var values = <span class="c-code__keyword">property</span>.Value.Select(x =&gt; </div><div class="c-code__line">                        Math.Abs(x.Weighting() - 1.0f) &lt; 0.0001f ? x.Value.ToString(<span class="c-code__stringliteral">&quot;F6&quot;</span>) : $<span class="c-code__stringliteral">&quot;({x.Value:F6} @ {x.Weighting():F4})&quot;</span>);</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {string.Join(&quot;</span>, <span class="c-code__stringliteral">&quot;, values)}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> OutputWeightedIPAddressValues(<span class="c-code__keywordtype">string</span> name, </div><div class="c-code__line">                IAspectPropertyValue&lt;IReadOnlyList&lt;IWeightedValue&lt;System.Net.IPAddress&gt;&gt;&gt; property,</div><div class="c-code__line">                StringBuilder message)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__keywordflow">if</span> (!property.HasValue)</div><div class="c-code__line">                {</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {property.NoValueMessage}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">                <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                {</div><div class="c-code__line">                    var values = <span class="c-code__keyword">property</span>.Value.Select(x =&gt; </div><div class="c-code__line">                        Math.Abs(x.Weighting() - 1.0f) &lt; 0.0001f ? x.Value.ToString() : $<span class="c-code__stringliteral">&quot;({x.Value} @ {x.Weighting():F4})&quot;</span>);</div><div class="c-code__line">                    message.AppendLine($<span class="c-code__stringliteral">&quot;\t{name}: {string.Join(&quot;</span>, <span class="c-code__stringliteral">&quot;, values)}&quot;</span>);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> Run(PipelineOptions options, TextWriter output)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Initialize a service collection which will be used to create the services</span></div><div class="c-code__line">                <span class="c-code__comment">// required by the Pipeline and manage their lifetimes.</span></div><div class="c-code__line">                <span class="c-code__keyword">using</span> (var serviceProvider = <span class="c-code__keyword">new</span> ServiceCollection()</div><div class="c-code__line">                    <span class="c-code__comment">// Add the configuration to the services collection.</span></div><div class="c-code__line">                    .AddSingleton(options)</div><div class="c-code__line">                    <span class="c-code__comment">// Make sure we&#39;re logging to the console.</span></div><div class="c-code__line">                    .AddLogging(l =&gt; l.AddConsole())</div><div class="c-code__line">                    <span class="c-code__comment">// Add an HttpClient instance. This is used for making requests to the</span></div><div class="c-code__line">                    <span class="c-code__comment">// Cloud service.</span></div><div class="c-code__line">                    .AddSingleton&lt;HttpClient&gt;()</div><div class="c-code__line">                    <span class="c-code__comment">// Add the builders that will be needed to create the engines specified in the </span></div><div class="c-code__line">                    <span class="c-code__comment">// configuration file.</span></div><div class="c-code__line">                    .AddSingleton&lt;CloudRequestEngineBuilder&gt;()</div><div class="c-code__line">                    .AddSingleton&lt;IpiCloudEngineBuilder&gt;()</div><div class="c-code__line">                    .AddSingleton&lt;DeviceDetectionCloudEngineBuilder&gt;()</div><div class="c-code__line">                    .BuildServiceProvider())</div><div class="c-code__line">                {</div><div class="c-code__line">                    <span class="c-code__comment">// Get the resource key setting from the config file. </span></div><div class="c-code__line">                    var resourceKey = options.GetResourceKey();</div><div class="c-code__line"></div><div class="c-code__line">                    <span class="c-code__comment">// If we don&#39;t have a resource key then log an error.</span></div><div class="c-code__line">                    <span class="c-code__keywordflow">if</span> (<span class="c-code__keywordtype">string</span>.IsNullOrWhiteSpace(resourceKey))</div><div class="c-code__line">                    {</div><div class="c-code__line">                        serviceProvider.GetRequiredService&lt;ILogger&lt;Program&gt;&gt;().LogError(</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;No resource key specified in the configuration file &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;&#39;appsettings.json&#39; or the environment variable &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;&#39;{ExampleUtils.CLOUD_RESOURCE_KEY_ENV_VAR}&#39;. The 51Degrees Cloud &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;service is accessed using a &#39;ResourceKey&#39;. For more information &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;see &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;https://51degrees.com/documentation/_info__resource_keys.html. &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;A resource key with the properties required by this example can be &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;created for free at https://configure.51degrees.com/1QWJwHxl. &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;Once complete, populate the config file or environment variable &quot;</span> +</div><div class="c-code__line">                            $<span class="c-code__stringliteral">&quot;mentioned at the start of this message with the key.&quot;</span>);</div><div class="c-code__line">                    }</div><div class="c-code__line">                    <span class="c-code__keywordflow">else</span></div><div class="c-code__line">                    {</div><div class="c-code__line">                        <span class="c-code__keyword">new</span> Example().Run(serviceProvider, output);</div><div class="c-code__line">                    }</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> Main(<span class="c-code__keywordtype">string</span>[] args)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Use the command line args to get the resource key if present.</span></div><div class="c-code__line">            <span class="c-code__comment">// Otherwise, get it from the environment variable.</span></div><div class="c-code__line">            <span class="c-code__keywordtype">string</span> resourceKey = args.Length &gt; 0 ? args[0] :</div><div class="c-code__line">                Environment.GetEnvironmentVariable(</div><div class="c-code__line">                    ExampleUtils.CLOUD_RESOURCE_KEY_ENV_VAR);</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Load the configuration file</span></div><div class="c-code__line">            var config = <span class="c-code__keyword">new</span> ConfigurationBuilder()</div><div class="c-code__line">                .AddJsonFile(<span class="c-code__stringliteral">&quot;appsettings.json&quot;</span>)</div><div class="c-code__line">                .Build();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Bind the configuration to a pipeline options instance</span></div><div class="c-code__line">            PipelineOptions options = <span class="c-code__keyword">new</span> PipelineOptions();</div><div class="c-code__line">            var section = config.GetRequiredSection(<span class="c-code__stringliteral">&quot;PipelineOptions&quot;</span>);</div><div class="c-code__line">            <span class="c-code__comment">// Use the &#39;ErrorOnUnknownConfiguration&#39; option to warn us if we&#39;ve got any</span></div><div class="c-code__line">            <span class="c-code__comment">// misnamed configuration keys.</span></div><div class="c-code__line">            section.Bind(options, (o) =&gt; { o.ErrorOnUnknownConfiguration = <span class="c-code__keyword">true</span>; });</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Get the resource key setting from the config file. </span></div><div class="c-code__line">            var resourceKeyFromConfig = options.GetResourceKey();</div><div class="c-code__line">            var configHasKey = <span class="c-code__keywordtype">string</span>.IsNullOrWhiteSpace(resourceKeyFromConfig) == <span class="c-code__keyword">false</span> &amp;&amp;</div><div class="c-code__line">                    resourceKeyFromConfig.StartsWith(<span class="c-code__stringliteral">&quot;!!&quot;</span>) == <span class="c-code__keyword">false</span>;</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// If no resource key is specified in the config file then override it with the key</span></div><div class="c-code__line">            <span class="c-code__comment">// from the environment variable / command line. </span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (configHasKey == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                options.SetResourceKey(resourceKey);</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">new</span> Example().Run(options, Console.Out);</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
