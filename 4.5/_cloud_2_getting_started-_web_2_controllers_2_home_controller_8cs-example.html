<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees IP Intelligence .NET: Cloud/GettingStarted-Web/Controllers/HomeController.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="/documentation/4.5/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees IP Intelligence .NET
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">IP intelligence services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_cloud_2_getting_started-_web_2_controllers_2_home_controller_8cs-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">Cloud/GettingStarted-Web/Controllers/HomeController.cs</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>This example shows how to integrate 51Degrees Cloud IP Intelligence service into an ASP.NET Core web application. The controller demonstrates processing visitor IP addresses to retrieve location and ISP information.</p>
<p>This example is available in full on <a href="https://github.com/51Degrees/ip-intelligence-dotnet-examples/blob/main/Examples/Cloud/GettingStarted-Web/Controllers/HomeController.cs">GitHub</a>.</p>
<p>To run this example, you will eventually need to create a Resource Key, but for now you should use the GettingStarted-API example - just run it and point this example to its custom endpoint to simulate a custom hosted Cloud service. Resource Key is used as shorthand to store the particular set of properties you are interested in as well as any associated License Keys that entitle you to increased request limits and/or paid-for properties, but it is not yet available for IP Intelligence.</p>
<p>Required NuGet Dependencies:</p><ul>
<li><a href="https://www.nuget.org/packages/FiftyOne.IpIntelligence/">FiftyOne.IpIntelligence</a></li>
<li><a href="https://www.nuget.org/packages/FiftyOne.Pipeline.Web/">FiftyOne.Pipeline.Web</a></li>
<li><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.App/">Microsoft.AspNetCore.App</a></li>
</ul>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Mvc;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Web.Services;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence.html">IpIntelligence</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples.html">Examples</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_cloud.html">Cloud</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_cloud_1_1_getting_started_web.html">GettingStartedWeb</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_cloud_1_1_getting_started_web_1_1_model.html">Model</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Logging;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Net;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_cloud_1_1_getting_started_web_1_1_controllers.html">FiftyOne.IpIntelligence.Examples.Cloud.GettingStartedWeb.Controllers</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>HomeController : Controller</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">private</span> IFlowDataProvider _provider;</div><div class="c-code__line">        <span class="c-code__keyword">private</span> ILogger&lt;HomeController&gt; _logger;</div><div class="c-code__line">        <span class="c-code__keyword">private</span> IPipeline _pipeline;</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// The controller has a dependency on IFlowDataProvider. This is used to access the </span></div><div class="c-code__line">        <span class="c-code__comment">// IFlowData that contains the IP Intelligence results for the current HTTP request.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> HomeController(IFlowDataProvider provider, ILogger&lt;HomeController&gt; logger, IPipeline pipeline)</div><div class="c-code__line">        {</div><div class="c-code__line">            _provider = provider;</div><div class="c-code__line">            _logger = logger;</div><div class="c-code__line">            _pipeline = pipeline;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> IActionResult Index(<span class="c-code__keywordtype">string</span> ipAddress = <span class="c-code__keyword">null</span>)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Get the visitor&#39;s IP address from the request</span></div><div class="c-code__line">            var visitorIp = HttpContext.Connection.RemoteIpAddress?.ToString();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// If no custom IP provided, use the visitor&#39;s IP</span></div><div class="c-code__line">            var targetIp = !<span class="c-code__keywordtype">string</span>.IsNullOrWhiteSpace(ipAddress) ? ipAddress : visitorIp;</div><div class="c-code__line"></div><div class="c-code__line">            IFlowData flowData;</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (!<span class="c-code__keywordtype">string</span>.IsNullOrWhiteSpace(targetIp))</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Create new flow data with specified IP address (custom or visitor&#39;s)</span></div><div class="c-code__line">                <span class="c-code__keyword">using</span> (flowData = _pipeline.CreateFlowData())</div><div class="c-code__line">                {</div><div class="c-code__line">                    flowData.AddEvidence(<span class="c-code__stringliteral">&quot;server.client-ip&quot;</span>, targetIp);</div><div class="c-code__line">                    flowData.Process();</div><div class="c-code__line"></div><div class="c-code__line">                    var model = <span class="c-code__keyword">new</span> IndexModel(flowData, Response.Headers);</div><div class="c-code__line">                    model.InputIpAddress = targetIp;</div><div class="c-code__line">                    <span class="c-code__keywordflow">return</span> View(model);</div><div class="c-code__line">                }</div><div class="c-code__line">            }</div><div class="c-code__line">            <span class="c-code__keywordflow">else</span></div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Fallback to default flow data if we can&#39;t determine IP</span></div><div class="c-code__line">                flowData = _provider.GetFlowData();</div><div class="c-code__line">                var model = <span class="c-code__keyword">new</span> IndexModel(flowData, Response.Headers);</div><div class="c-code__line">                model.InputIpAddress = visitorIp;</div><div class="c-code__line">                <span class="c-code__keywordflow">return</span> View(model);</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
