<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees IP Intelligence .NET: Cloud/GettingStarted-Web/Startup.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="/documentation/4.5/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees IP Intelligence .NET
   &#160;<span id="projectnumber">4.5</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">IP intelligence services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_cloud_2_getting_started-_web_2_startup_8cs-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">Cloud/GettingStarted-Web/Startup.cs</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>This example shows how to configure and use 51Degrees Cloud IP Intelligence in a web application.You will learn:</p>
<ol type="1">
<li>How to configure a Pipeline that uses 51Degrees Cloud IP Intelligence in a web application</li>
<li>How the PipelineFilter automatically processes requests and makes results available</li>
<li>How to retrieve IP Intelligence results in your web application</li>
</ol>
<p>The source code for this example is available in full on <a href="https://github.com/51Degrees/ip-intelligence-dotnet-examples/tree/main/Examples/Cloud/GettingStarted-Web">GitHub</a>.</p>
<p>To run this example, you will eventually need to create a Resource Key, but for now you should use the GettingStarted-API example - just run it and point this example to its custom endpoint to simulate a custom hosted Cloud service. Resource Key is used as shorthand to store the particular set of properties you are interested in as well as any associated License Keys that entitle you to increased request limits and/or paid-for properties, but it is not yet available for IP Intelligence.</p>
<p>Required NuGet Dependencies:</p><ul>
<li><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.App/">Microsoft.AspNetCore.App</a></li>
<li><a href="https://www.nuget.org/packages/FiftyOne.IpIntelligence/">FiftyOne.IpIntelligence</a></li>
<li><a href="https://www.nuget.org/packages/FiftyOne.Pipeline.Web/">FiftyOne.Pipeline.Web</a></li>
</ul>
<h2>Overview</h2>
<p>The <code>UseFiftyOne</code> extension method is used to create a Pipeline instance from the configuration that is supplied. The <code>AddFiftyOne</code> extension method adds a <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware">middleware</a> component that will intercept requests and perform device detection. The results will be stored in the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.httpcontext.items">HttpContext</a>. The middleware will also handle setting response headers (e.g. Accept-CH for User-Agent Client Hints) and serving requests for client-side JavaScript and JSON resources. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">services.AddFiftyOne(Configuration);</div><div class="c-code__line"></div><div class="c-code__line">app.UseFiftyOne();</div></div><p>The results of detection can be accessed by adding a dependency on IFlowDataProvider. This can then be used to interrogate the data. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">var flowData = _provider.GetFlowData();</div><div class="c-code__line">var deviceData = flowData.Get&lt;IDeviceData&gt;();</div><div class="c-code__line">var hardwareVendor = deviceData.HardwareVendor;</div></div><p>Results can also be accessed in client-side code by using the <code>fod</code> object. See the <a href="https://51degrees.com/pipeline-dotnet/class_fifty_one_1_1_pipeline_1_1_java_script_builder_1_1_flow_element_1_1_java_script_builder_element_builder.html">JavaScriptBuilderElementBuilder</a> for details on available settings such as changing the <code>fod</code> name. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">window.onload = function () {</div><div class="c-code__line">    fod.complete(function(data) {</div><div class="c-code__line">        var hardwareName = data.device.hardwarename;</div><div class="c-code__line">        alert(hardwareName.join(&quot;, &quot;));</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div><h2>Configuration</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;Logging&quot;: {</div><div class="c-code__line">    &quot;LogLevel&quot;: {</div><div class="c-code__line">      &quot;Default&quot;: &quot;Information&quot;,</div><div class="c-code__line">      &quot;Microsoft&quot;: &quot;Warning&quot;,</div><div class="c-code__line">      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;</div><div class="c-code__line">    }</div><div class="c-code__line">  },</div><div class="c-code__line">  &quot;AllowedHosts&quot;: &quot;*&quot;</div><div class="c-code__line">}</div></div><h2>Controller</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Mvc;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Web.Services;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence.html">IpIntelligence</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples.html">Examples</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_mixed.html">Mixed</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_mixed_1_1_on_premise.html">OnPremise</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_mixed_1_1_on_premise_1_1_getting_started_web.html">GettingStartedWeb</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_mixed_1_1_on_premise_1_1_getting_started_web_1_1_model.html">Model</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Logging;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.DeviceDetection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Collections.Generic;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Linq;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Http;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Text;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_mixed_1_1_on_premise_1_1_getting_started_web_1_1_controllers.html">FiftyOne.IpIntelligence.Examples.Mixed.OnPremise.GettingStartedWeb.Controllers</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>HomeController : Controller</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">bool</span> _checkedDataFile = <span class="c-code__keyword">false</span>;</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">private</span> IFlowDataProvider _provider;</div><div class="c-code__line">        <span class="c-code__keyword">private</span> ILogger&lt;HomeController&gt; _logger;</div><div class="c-code__line">        <span class="c-code__keyword">private</span> IPipeline _pipeline;</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// The controller has a dependency on IFlowDataProvider. This is used to access the </span></div><div class="c-code__line">        <span class="c-code__comment">// IFlowData that contains both Device Detection and IP Intelligence results </span></div><div class="c-code__line">        <span class="c-code__comment">// for the current HTTP request.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> HomeController(IFlowDataProvider provider, ILogger&lt;HomeController&gt; logger, IPipeline pipeline)</div><div class="c-code__line">        {</div><div class="c-code__line">            _provider = provider;</div><div class="c-code__line">            _logger = logger;</div><div class="c-code__line">            _pipeline = pipeline;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> IActionResult Index()</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Log warnings if the data file is too old or the &#39;Lite&#39; file is being used.</span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span>(_checkedDataFile == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                Examples.OnPremise.ExampleUtils.CheckDataFile(_provider.GetFlowData().Pipeline, _logger);</div><div class="c-code__line">                _checkedDataFile = <span class="c-code__keyword">true</span>;</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Get the flow data from the provider. This contains detection results</span></div><div class="c-code__line">            <span class="c-code__comment">// based on the evidence from the current request (User-Agent, client hints, etc.)</span></div><div class="c-code__line">            <span class="c-code__comment">// The 51Degrees middleware automatically adds query parameters with &quot;query.&quot; prefix</span></div><div class="c-code__line">            var flowData = _provider.GetFlowData();</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Create the model to pass to the view</span></div><div class="c-code__line">            var model = <span class="c-code__keyword">new</span> IndexModel();</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Get Device Detection results from the flow data</span></div><div class="c-code__line">            model.Device = flowData.Get&lt;IDeviceData&gt;();</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Get IP Intelligence results from the flow data</span></div><div class="c-code__line">            model.IpData = flowData.Get&lt;IIpIntelligenceData&gt;();</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Check if a custom IP was provided via query parameter</span></div><div class="c-code__line">            var clientIp = Request.Query[<span class="c-code__stringliteral">&quot;client-ip&quot;</span>].FirstOrDefault();</div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (!<span class="c-code__keywordtype">string</span>.IsNullOrWhiteSpace(clientIp))</div><div class="c-code__line">            {</div><div class="c-code__line">                model.UserInputIp = clientIp;</div><div class="c-code__line">                model.IpMessage = $<span class="c-code__stringliteral">&quot;Showing location data for: {clientIp}&quot;</span>;</div><div class="c-code__line">            }</div><div class="c-code__line">            <span class="c-code__keywordflow">else</span></div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Use the visitor&#39;s own IP address</span></div><div class="c-code__line">                var visitorIp = HttpContext.Connection.RemoteIpAddress?.ToString();</div><div class="c-code__line">                model.UserInputIp = visitorIp;</div><div class="c-code__line">                model.IpMessage = <span class="c-code__stringliteral">&quot;Showing location data for your IP address&quot;</span>;</div><div class="c-code__line">            }</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Note: JavaScript for client-side evidence gathering is handled </span></div><div class="c-code__line">            <span class="c-code__comment">// by the FiftyOneJS view component in the view</span></div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Build device message</span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (model.Device != <span class="c-code__keyword">null</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                var deviceType = model.Device.DeviceType.HasValue ? model.Device.DeviceType.Value : <span class="c-code__stringliteral">&quot;Unknown&quot;</span>;</div><div class="c-code__line">                var browserName = model.Device.BrowserName.HasValue ? model.Device.BrowserName.Value : <span class="c-code__stringliteral">&quot;Unknown&quot;</span>;</div><div class="c-code__line">                var platformName = model.Device.PlatformName.HasValue ? model.Device.PlatformName.Value : <span class="c-code__stringliteral">&quot;Unknown&quot;</span>;</div><div class="c-code__line">                </div><div class="c-code__line">                model.DeviceMessage = $<span class="c-code__stringliteral">&quot;You are using {browserName} on {platformName} ({deviceType})&quot;</span>;</div><div class="c-code__line">            }</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Collect evidence for display</span></div><div class="c-code__line">            model.Evidence = <span class="c-code__keyword">new</span> List&lt;EvidenceModel&gt;();</div><div class="c-code__line">            <span class="c-code__keywordflow">foreach</span> (var evidence <span class="c-code__keywordflow">in</span> flowData.GetEvidence().AsDictionary())</div><div class="c-code__line">            {</div><div class="c-code__line">                model.Evidence.Add(<span class="c-code__keyword">new</span> EvidenceModel</div><div class="c-code__line">                {</div><div class="c-code__line">                    Key = evidence.Key,</div><div class="c-code__line">                    Value = evidence.Value?.ToString() ?? <span class="c-code__stringliteral">&quot;null&quot;</span></div><div class="c-code__line">                });</div><div class="c-code__line">            }</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Set response headers for client hints</span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (Response != <span class="c-code__keyword">null</span> &amp;&amp; Response.Headers != <span class="c-code__keyword">null</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                SetResponseHeaders(flowData, Response.Headers);</div><div class="c-code__line">            }</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__keywordflow">return</span> View(model);</div><div class="c-code__line">        }</div><div class="c-code__line">        </div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keywordtype">void</span> SetResponseHeaders(IFlowData flowData, IHeaderDictionary headers)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Add Accept-CH header for client hints</span></div><div class="c-code__line">            var acceptCH = <span class="c-code__keyword">new</span> StringBuilder();</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__comment">// Check for device detection properties that require client hints</span></div><div class="c-code__line">            var device = flowData.Get&lt;IDeviceData&gt;();</div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (device != <span class="c-code__keyword">null</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Add standard client hints</span></div><div class="c-code__line">                acceptCH.Append(<span class="c-code__stringliteral">&quot;Sec-CH-UA-Model,Sec-CH-UA-Platform,Sec-CH-UA-Platform-Version,&quot;</span>);</div><div class="c-code__line">                acceptCH.Append(<span class="c-code__stringliteral">&quot;Sec-CH-UA-Mobile,Sec-CH-UA-Full-Version-List,Sec-CH-UA-Arch&quot;</span>);</div><div class="c-code__line">                </div><div class="c-code__line">                headers[<span class="c-code__stringliteral">&quot;Accept-CH&quot;</span>] = acceptCH.ToString().TrimEnd(<span class="c-code__charliteral">&#39;,&#39;</span>);</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div><h2>View</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">@* *********************************************************************</div><div class="c-code__line"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</div><div class="c-code__line"> * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,</div><div class="c-code__line"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</div><div class="c-code__line"> *</div><div class="c-code__line"> * This Original Work is licensed under the European Union Public Licence</div><div class="c-code__line"> * (EUPL) v.1.2 and is subject to its terms as set out below.</div><div class="c-code__line"> *</div><div class="c-code__line"> * If a copy of the EUPL was not distributed with this file, You can obtain</div><div class="c-code__line"> * one at https://opensource.org/licenses/EUPL-1.2.</div><div class="c-code__line"> *</div><div class="c-code__line"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</div><div class="c-code__line"> * amended by the European Commission) shall be deemed incompatible for</div><div class="c-code__line"> * the purposes of the Work and the provisions of the compatibility</div><div class="c-code__line"> * clause in Article 5 of the EUPL shall not apply.</div><div class="c-code__line"> *</div><div class="c-code__line"> * If using the Work as, or as part of, a network application, by</div><div class="c-code__line"> * including the attribution notice(s) required under Article 5 of the EUPL</div><div class="c-code__line"> * in the end user terms of the application under an appropriate heading,</div><div class="c-code__line"> * such notice(s) shall fulfill the requirements of that article.</div><div class="c-code__line"> * ********************************************************************* *@</div><div class="c-code__line"></div><div class="c-code__line">@model FiftyOne.IpIntelligence.Examples.Mixed.OnPremise.GettingStartedWeb.Model.IndexModel</div><div class="c-code__line">@{</div><div class="c-code__line">    ViewData[&quot;Title&quot;] = &quot;Device Detection + IP Intelligence Example&quot;;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">&lt;link rel=&quot;stylesheet&quot; href=&quot;~/css/site.css&quot; /&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;h2&gt;Combined Device Detection and IP Intelligence Example&lt;/h2&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;p&gt;</div><div class="c-code__line">    This example demonstrates the use of the Pipeline API to perform both device detection and </div><div class="c-code__line">    IP intelligence lookups within a single ASP.NET Core web project. It highlights:</div><div class="c-code__line">    &lt;ol&gt;</div><div class="c-code__line">        &lt;li&gt;Device detection using User-Agent and Client Hints&lt;/li&gt;</div><div class="c-code__line">        &lt;li&gt;IP-based geolocation and network information&lt;/li&gt;</div><div class="c-code__line">        &lt;li&gt;Client-side evidence collection for enhanced detection&lt;/li&gt;</div><div class="c-code__line">        &lt;li&gt;Parallel processing of both engines for optimal performance&lt;/li&gt;</div><div class="c-code__line">    &lt;/ol&gt;</div><div class="c-code__line">&lt;/p&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;noscript&gt;</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: JavaScript is disabled in your browser. This means that client-side evidence </div><div class="c-code__line">        collection will not work and some device properties may not be accurately detected.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">&lt;/noscript&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;div id=&quot;content&quot;&gt;</div><div class="c-code__line">    &lt;!-- IP Address Input Form --&gt;</div><div class="c-code__line">    &lt;form method=&quot;get&quot; asp-action=&quot;Index&quot; style=&quot;margin-bottom: 25px;&quot;&gt;</div><div class="c-code__line">        &lt;div&gt;</div><div class="c-code__line">            &lt;label for=&quot;client-ip&quot; style=&quot;font-weight: bold;&quot;&gt;IP Address Lookup:&lt;/label&gt;</div><div class="c-code__line">            &lt;input type=&quot;text&quot; id=&quot;client-ip&quot; name=&quot;client-ip&quot; value=&quot;@Model.UserInputIp&quot; </div><div class="c-code__line">                   placeholder=&quot;e.g., 8.8.8.8&quot; style=&quot;margin-left: 10px; padding: 8px; width: 200px; border: 1px solid #ccc; border-radius: 4px;&quot;&gt;</div><div class="c-code__line">            &lt;button type=&quot;submit&quot; style=&quot;margin-left: 10px; padding: 8px 20px; background-color: #007cba; color: white; border: none; border-radius: 4px; cursor: pointer;&quot;&gt;Look Up&lt;/button&gt;</div><div class="c-code__line">        &lt;/div&gt;</div><div class="c-code__line">    &lt;/form&gt;</div><div class="c-code__line">    </div><div class="c-code__line">    &lt;div style=&quot;display: flex; gap: 20px;&quot;&gt;</div><div class="c-code__line">        &lt;!-- Device Detection Results Column --&gt;</div><div class="c-code__line">        &lt;div style=&quot;flex: 1;&quot;&gt;</div><div class="c-code__line">            &lt;h3&gt;Device Detection Results&lt;/h3&gt;</div><div class="c-code__line">            @if (!string.IsNullOrEmpty(Model.DeviceMessage))</div><div class="c-code__line">            {</div><div class="c-code__line">                &lt;p class=&quot;device-summary&quot;&gt;@Model.DeviceMessage&lt;/p&gt;</div><div class="c-code__line">            }</div><div class="c-code__line">            &lt;table&gt;</div><div class="c-code__line">                &lt;tr&gt;</div><div class="c-code__line">                    &lt;th&gt;Property&lt;/th&gt;</div><div class="c-code__line">                    &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Hardware Vendor:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.HardwareVendor?.HasValue == true ? string.Join(&quot;, &quot;, Model.Device.HardwareVendor.Value) : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Hardware Name:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.HardwareName?.HasValue == true ? string.Join(&quot;, &quot;, Model.Device.HardwareName.Value) : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Device Type:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.DeviceType?.HasValue == true ? Model.Device.DeviceType.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Platform Vendor:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.PlatformVendor?.HasValue == true ? string.Join(&quot;, &quot;, Model.Device.PlatformVendor.Value) : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Platform Name:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.PlatformName?.HasValue == true ? Model.Device.PlatformName.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Platform Version:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.PlatformVersion?.HasValue == true ? Model.Device.PlatformVersion.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Browser Vendor:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.BrowserVendor?.HasValue == true ? string.Join(&quot;, &quot;, Model.Device.BrowserVendor.Value) : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Browser Name:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.BrowserName?.HasValue == true ? Model.Device.BrowserName.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Browser Version:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.BrowserVersion?.HasValue == true ? Model.Device.BrowserVersion.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Screen width (pixels):&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.ScreenPixelsWidth?.HasValue == true ? Model.Device.ScreenPixelsWidth.Value.ToString() : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Screen height (pixels):&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.ScreenPixelsHeight?.HasValue == true ? Model.Device.ScreenPixelsHeight.Value.ToString() : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Device Id:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.Device?.DeviceId?.HasValue == true ? Model.Device.DeviceId.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">            &lt;/table&gt;</div><div class="c-code__line">        &lt;/div&gt;</div><div class="c-code__line"></div><div class="c-code__line">        &lt;!-- IP Intelligence Results Column --&gt;</div><div class="c-code__line">        &lt;div style=&quot;flex: 1;&quot;&gt;</div><div class="c-code__line">            &lt;h3&gt;IP Intelligence Results&lt;/h3&gt;</div><div class="c-code__line">            </div><div class="c-code__line">            @if (!string.IsNullOrEmpty(Model.IpMessage))</div><div class="c-code__line">            {</div><div class="c-code__line">                &lt;p class=&quot;ip-summary&quot;&gt;@Model.IpMessage&lt;/p&gt;</div><div class="c-code__line">            }</div><div class="c-code__line">            </div><div class="c-code__line">            &lt;table&gt;</div><div class="c-code__line">                &lt;tr&gt;</div><div class="c-code__line">                    &lt;th&gt;Property&lt;/th&gt;</div><div class="c-code__line">                    &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Registered Name:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.RegisteredName?.HasValue == true ? Model.IpData.RegisteredName.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Registered Owner:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.RegisteredOwner?.HasValue == true ? Model.IpData.RegisteredOwner.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Registered Country:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.RegisteredCountry?.HasValue == true ? Model.IpData.RegisteredCountry.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;IP Range Start:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.IpRangeStart?.HasValue == true ? Model.IpData.IpRangeStart.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;IP Range End:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.IpRangeEnd?.HasValue == true ? Model.IpData.IpRangeEnd.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Country:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.Country?.HasValue == true ? Model.IpData.Country.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Country Code:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.CountryCode?.HasValue == true ? Model.IpData.CountryCode.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Country Code 3:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.CountryCode3?.HasValue == true ? Model.IpData.CountryCode3.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Region:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.Region?.HasValue == true ? Model.IpData.Region.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;State:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.State?.HasValue == true ? Model.IpData.State.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Town:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.Town?.HasValue == true ? Model.IpData.Town.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Latitude:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.Latitude?.HasValue == true ? Model.IpData.Latitude.Value.ToString(&quot;F4&quot;) : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Longitude:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.Longitude?.HasValue == true ? Model.IpData.Longitude.Value.ToString(&quot;F4&quot;) : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Areas:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.Areas?.HasValue == true ? Model.IpData.Areas.Value : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Accuracy Radius:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.AccuracyRadiusMin?.HasValue == true ? Model.IpData.AccuracyRadiusMin.Value.ToString() : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                &lt;tr class=&quot;lightgreen&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;Time Zone Offset:&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(Model.IpData?.TimeZoneOffset?.HasValue == true ? Model.IpData.TimeZoneOffset.Value.ToString() : &quot;Unknown&quot;)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">            &lt;/table&gt;</div><div class="c-code__line">        &lt;/div&gt;</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line"></div><div class="c-code__line">    &lt;br /&gt;</div><div class="c-code__line">    </div><div class="c-code__line">    &lt;!-- Evidence Section --&gt;</div><div class="c-code__line">    &lt;div id=&quot;evidence&quot;&gt;</div><div class="c-code__line">        &lt;h3&gt;Evidence Used&lt;/h3&gt;</div><div class="c-code__line">        &lt;p class=&quot;smaller&quot;&gt;Evidence collected from the current request&lt;/p&gt;</div><div class="c-code__line">        &lt;details&gt;</div><div class="c-code__line">            &lt;summary&gt;Click to view evidence details&lt;/summary&gt;</div><div class="c-code__line">            &lt;table style=&quot;margin-top: 10px;&quot;&gt;</div><div class="c-code__line">                &lt;tr&gt;</div><div class="c-code__line">                    &lt;th&gt;Key&lt;/th&gt;</div><div class="c-code__line">                    &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">                @if (Model.Evidence != null)</div><div class="c-code__line">                {</div><div class="c-code__line">                    var index = 0;</div><div class="c-code__line">                    @foreach (var entry in Model.Evidence)</div><div class="c-code__line">                    {</div><div class="c-code__line">                        &lt;tr class=&quot;@(index % 2 == 0 ? &quot;lightyellow&quot; : &quot;lightgreen&quot;)&quot;&gt;</div><div class="c-code__line">                            &lt;td&gt;&lt;b&gt;@entry.Key&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                            &lt;td&gt;@(entry.Value.Length &gt; 100 ? entry.Value.Substring(0, 100) + &quot;...&quot; : entry.Value)&lt;/td&gt;</div><div class="c-code__line">                        &lt;/tr&gt;</div><div class="c-code__line">                        index++;</div><div class="c-code__line">                    }</div><div class="c-code__line">                }</div><div class="c-code__line">            &lt;/table&gt;</div><div class="c-code__line">        &lt;/details&gt;</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">&lt;/div&gt;</div><div class="c-code__line"></div><div class="c-code__line">@* Client-side JavaScript for evidence gathering and device detection callbacks.</div><div class="c-code__line">    This View Component is provided by the FiftyOne.Pipeline.Web package.</div><div class="c-code__line">    It generates the necessary JavaScript for client-side evidence collection</div><div class="c-code__line">    and handles callbacks for enhanced device detection. *@</div><div class="c-code__line">@await Component.InvokeAsync(&quot;FiftyOneJS&quot;)</div><div class="c-code__line"></div><div class="c-code__line">&lt;script&gt;</div><div class="c-code__line">    window.onload = function () {</div><div class="c-code__line">        // Subscribe to the &#39;complete&#39; event which fires when client-side evidence </div><div class="c-code__line">        // has been collected and sent back to the server for enhanced detection.</div><div class="c-code__line">        fod.complete(function (data) {</div><div class="c-code__line">            console.log(&#39;51Degrees client-side evidence collection completed&#39;);</div><div class="c-code__line">            console.log(&#39;Enhanced device data available:&#39;, data.device);</div><div class="c-code__line">            </div><div class="c-code__line">            // Optionally refresh the page to show updated results with client-side evidence</div><div class="c-code__line">            // location.reload();</div><div class="c-code__line">        });</div><div class="c-code__line">    }   </div><div class="c-code__line">&lt;/script&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;style&gt;</div><div class="c-code__line">    .device-summary, .ip-summary {</div><div class="c-code__line">        background-color: #f0f8ff;</div><div class="c-code__line">        padding: 10px;</div><div class="c-code__line">        border-radius: 5px;</div><div class="c-code__line">        margin-bottom: 15px;</div><div class="c-code__line">    }</div><div class="c-code__line">    </div><div class="c-code__line">    table {</div><div class="c-code__line">        width: 100%;</div><div class="c-code__line">        border-collapse: collapse;</div><div class="c-code__line">    }</div><div class="c-code__line">    </div><div class="c-code__line">    th, td {</div><div class="c-code__line">        padding: 8px;</div><div class="c-code__line">        text-align: left;</div><div class="c-code__line">        border-bottom: 1px solid #ddd;</div><div class="c-code__line">    }</div><div class="c-code__line">    </div><div class="c-code__line">    .lightgreen {</div><div class="c-code__line">        background-color: #f0fff0;</div><div class="c-code__line">    }</div><div class="c-code__line">    </div><div class="c-code__line">    .lightyellow {</div><div class="c-code__line">        background-color: #fffff0;</div><div class="c-code__line">    }</div><div class="c-code__line">    </div><div class="c-code__line">    details {</div><div class="c-code__line">        margin-top: 20px;</div><div class="c-code__line">    }</div><div class="c-code__line">    </div><div class="c-code__line">    summary {</div><div class="c-code__line">        cursor: pointer;</div><div class="c-code__line">        padding: 10px;</div><div class="c-code__line">        background-color: #f5f5f5;</div><div class="c-code__line">        border-radius: 5px;</div><div class="c-code__line">    }</div><div class="c-code__line">    </div><div class="c-code__line">    summary:hover {</div><div class="c-code__line">        background-color: #e8e8e8;</div><div class="c-code__line">    }</div><div class="c-code__line">&lt;/style&gt;</div></div><h2>Startup</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2023 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence.html">IpIntelligence</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_cloud.html">Cloud</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_cloud_1_1_flow_elements.html">FlowElements</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.CloudRequestEngine.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Builder;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Hosting;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Http;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Configuration;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.DependencyInjection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Threading.Tasks;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_cloud_1_1_getting_started_web.html">FiftyOne.IpIntelligence.Examples.Cloud.GettingStartedWeb</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Startup</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">public</span> Startup(IConfiguration configuration)</div><div class="c-code__line">        {</div><div class="c-code__line">            Configuration = configuration;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> IConfiguration Configuration { <span class="c-code__keyword">get</span>; }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// This method gets called by the runtime. Use this method to add services to the container.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> ConfigureServices(IServiceCollection services)</div><div class="c-code__line">        {</div><div class="c-code__line">            services.AddControllersWithViews();</div><div class="c-code__line"></div><div class="c-code__line">            services.Configure&lt;CookiePolicyOptions&gt;(options =&gt;</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// This lambda determines whether user consent for non-essential cookies is needed</span></div><div class="c-code__line">                <span class="c-code__comment">// for a given request.</span></div><div class="c-code__line">                options.CheckConsentNeeded = context =&gt; <span class="c-code__keyword">true</span>;</div><div class="c-code__line">                options.MinimumSameSitePolicy = SameSiteMode.None;</div><div class="c-code__line">            });</div><div class="c-code__line"></div><div class="c-code__line">            services.AddMvc();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Add the cloud request and device detection engine builder to services so that the</span></div><div class="c-code__line">            <span class="c-code__comment">// system can find the builders when it needs to.</span></div><div class="c-code__line">            services.AddSingleton&lt;CloudRequestEngineBuilder&gt;();</div><div class="c-code__line">            services.AddSingleton&lt;IpiCloudEngineBuilder&gt;();</div><div class="c-code__line">            <span class="c-code__comment">// Configure the services needed by device detection and create the 51Degrees Pipeline</span></div><div class="c-code__line">            <span class="c-code__comment">// instance that will be used to process requests.</span></div><div class="c-code__line">            services.AddFiftyOne(Configuration);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// This method gets called by the runtime. Use this method to configure the HTTP request</span></div><div class="c-code__line">        <span class="c-code__comment">// pipeline.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)</div><div class="c-code__line">        {</div><div class="c-code__line">            app.UseDeveloperExceptionPage();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// This is only needed when running under an ASP.NET test server.</span></div><div class="c-code__line">            app.UseMiddleware&lt;UserAgentCorrectionMiddleware&gt;();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Add the 51Degrees middleware component.</span></div><div class="c-code__line">            <span class="c-code__comment">// This will pass any incoming requests through the pipeline API, performing device</span></div><div class="c-code__line">            <span class="c-code__comment">// detection. The IFlowData that is used will be stored in the data associated with </span></div><div class="c-code__line">            <span class="c-code__comment">// the current HTTP session.</span></div><div class="c-code__line">            <span class="c-code__comment">// The IFlowDataAccessor provides an easy way to retrieve this data. See HomeController</span></div><div class="c-code__line">            <span class="c-code__comment">// for an example of this.</span></div><div class="c-code__line">            app.UseFiftyOne();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseStaticFiles();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseRouting();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseAuthorization();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseEndpoints(endpoints =&gt;</div><div class="c-code__line">            {</div><div class="c-code__line">                endpoints.MapControllerRoute(</div><div class="c-code__line">                    name: <span class="c-code__stringliteral">&quot;default&quot;</span>,</div><div class="c-code__line">                    pattern: <span class="c-code__stringliteral">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span>);</div><div class="c-code__line">            });</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keyword">class </span>UserAgentCorrectionMiddleware</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__keyword">private</span> readonly RequestDelegate next;</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> UserAgentCorrectionMiddleware(RequestDelegate next)</div><div class="c-code__line">            {</div><div class="c-code__line">                this.next = next;</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> async Task Invoke(HttpContext httpContext)</div><div class="c-code__line">            {</div><div class="c-code__line">                var val = httpContext.Request.Headers[<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>];</div><div class="c-code__line">                httpContext.Request.Headers.Remove(<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>);</div><div class="c-code__line">                httpContext.Request.Headers[<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>] =</div><div class="c-code__line">                    <span class="c-code__keyword">new</span> Microsoft.Extensions.Primitives.StringValues(<span class="c-code__keywordtype">string</span>.Join(<span class="c-code__stringliteral">&quot; &quot;</span>, val));</div><div class="c-code__line">                await this.next(httpContext);</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
