<!-- HTML header for doxygen 1.8.15-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees IP Intelligence .NET: OnPremise/GettingStarted-Web/Startup.cs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="examplegrabber.js"></script>
<script type="text/javascript" src="testedversionsgrabber.js"></script>
<script type="text/javascript" src="search51.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="docs-main.min.css" rel="stylesheet" type="text/css" />
</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  <a id="projectlogo" href="../../documentation/4.4/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png" style="width:172px;"/></a>
  <span class="c-tagline">51Degrees IP Intelligence .NET
   &#160;<span id="projectnumber">4.4</span>
  </span>
  </h1>
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">IP intelligence services for 51Degrees Pipeline</div>
  </div>
  <div id="main-nav"></div>
  <section class="g-search">
    <div class="c-search is-openable" id="searchOpenable">
    <form class="c-search__form">
      <div class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img src="icon-search.svg" class="b-icon" alt="Search" />
        <input type="text" class="c-search__input" id="inputSearch" onkeyup="javascript:onSearch(this,event.keyCode)" placeholder="Search" aria-label="Search">
      </div>
    </form>
    <div class="c-search__content" id="searchContent">
    </div>
  </div> 
  </section>
</div>
<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_on_premise_2_getting_started-_web_2_startup_8cs-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<div class="g-docs__header">
<h2 class="g-docs__page-title">OnPremise/GettingStarted-Web/Startup.cs</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>The source code for this example is available in full on <a href="https://github.com/51Degrees/ip-intelligence-dotnet-examples/tree/master/Examples/OnPremise/GettingStarted-Web">GitHub</a>.</p>
<p>
<p>
This example requires a local data file. The free 'Lite' data file can be acquired by
pulling the git submodules under this repository (run `git submodule update --recursive`) 
or from the <a href="https://github.com/51Degrees/device-detection-data">device-detection-data</a>
GitHub repository.
</p>
<p>
The Lite data file is only used for illustration, and has limited accuracy and capabilities.
Find out about the more capable data files that are available on our 
<a href="https://51degrees.com/pricing">pricing page</a>
</p>
</p>
<p>Required NuGet Dependencies:</p><ul>
<li><a href="https://www.nuget.org/packages/Microsoft.AspNetCore.App/">Microsoft.AspNetCore.App</a></li>
<li><a href="https://www.nuget.org/packages/FiftyOne.IpIntelligence/">FiftyOne.IpIntelligence</a></li>
<li><a href="https://www.nuget.org/packages/FiftyOne.Pipeline.Web/">FiftyOne.Pipeline.Web</a></li>
</ul>
<h2>Overview</h2>
<p>The <code>UseFiftyOne</code> extension method is used to create a Pipeline instance from the configuration that is supplied. The <code>AddFiftyOne</code> extension method adds a <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/middleware">middleware</a> component that will intercept requests and perform IP Intelligence. The results will be stored in the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.httpcontext.items">HttpContext</a>. The middleware will also handle setting response headers (e.g. Accept-CH for User-Agent Client Hints) and serving requests for client-side JavaScript and JSON resources. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">services.AddFiftyOne(Configuration);</div><div class="c-code__line"></div><div class="c-code__line">app.UseFiftyOne();</div></div><p>The results of detection can be accessed by adding a dependency on IFlowDataProvider. This can then be used to interrogate the data. </p><div class="c-code__block c-code__block--outline"><div class="c-code__line">var flowData = _provider.GetFlowData();</div><div class="c-code__line">var ipiData = flowData.Get&lt;IIpIntelligenceData&gt;();</div><div class="c-code__line">var hardwareVendor = ipiData.HardwareVendor;</div></div><h2>Configuration</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">{</div><div class="c-code__line">  &quot;Logging&quot;: {</div><div class="c-code__line">    &quot;LogLevel&quot;: {</div><div class="c-code__line">      &quot;Default&quot;: &quot;Information&quot;,</div><div class="c-code__line">      &quot;Microsoft&quot;: &quot;Warning&quot;,</div><div class="c-code__line">      &quot;Microsoft.Hosting.Lifetime&quot;: &quot;Information&quot;</div><div class="c-code__line">    }</div><div class="c-code__line">  },</div><div class="c-code__line">  &quot;AllowedHosts&quot;: &quot;*&quot;,</div><div class="c-code__line">  // For a sample configuration file demonstrating all available options, see </div><div class="c-code__line">  // https://github.com/51Degrees/device-detection-dotnet-examples/blob/main/Examples/sample-configuration.json</div><div class="c-code__line">  &quot;PipelineOptions&quot;: {</div><div class="c-code__line">    &quot;Elements&quot;: [</div><div class="c-code__line">      {</div><div class="c-code__line">        &quot;BuilderName&quot;: &quot;IpiOnPremiseEngineBuilder&quot;,</div><div class="c-code__line">        &quot;BuildParameters&quot;: {</div><div class="c-code__line">          &quot;DataFile&quot;: &quot;51Degrees-LiteV41.ipi&quot;,</div><div class="c-code__line">          &quot;CreateTempDataCopy&quot;: false,</div><div class="c-code__line">          &quot;AutoUpdate&quot;: false,</div><div class="c-code__line">          &quot;PerformanceProfile&quot;: &quot;MaxPerformance&quot;,</div><div class="c-code__line">          &quot;DataFileSystemWatcher&quot;: false,</div><div class="c-code__line">          &quot;DataUpdateOnStartUp&quot;: false,</div><div class="c-code__line">          // Include all properties to match the console example</div><div class="c-code__line">          &quot;Properties&quot;: &quot;RegisteredName,RegisteredOwner,RegisteredCountry,IpRangeStart,IpRangeEnd,Country,CountryCode,CountryCode3,Region,State,Town,Latitude,Longitude,Areas,AccuracyRadius,TimeZoneOffset&quot;</div><div class="c-code__line">        }</div><div class="c-code__line">      }</div><div class="c-code__line">    ],</div><div class="c-code__line">    // Disable client-side evidence to avoid JSON serialization issues with IPAddress</div><div class="c-code__line">    &quot;ClientSideEvidenceEnabled&quot;: false,</div><div class="c-code__line">    &quot;UseAsyncScript&quot;: false</div><div class="c-code__line">  }</div><div class="c-code__line">}</div></div><h2>Controller</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Mvc;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Web.Services;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence.html">IpIntelligence</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples.html">Examples</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_on_premise.html">OnPremise</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_on_premise_1_1_getting_started_web.html">GettingStartedWeb</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_on_premise_1_1_getting_started_web_1_1_model.html">Model</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Logging;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.FlowElements;</div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.Pipeline.Core.Data;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Net;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_on_premise_1_1_getting_started_web_1_1_controllers.html">FiftyOne.IpIntelligence.Examples.OnPremise.GettingStartedWeb.Controllers</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>HomeController : Controller</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keyword">static</span> <span class="c-code__keywordtype">bool</span> _checkedDataFile = <span class="c-code__keyword">false</span>;</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">private</span> IFlowDataProvider _provider;</div><div class="c-code__line">        <span class="c-code__keyword">private</span> ILogger&lt;HomeController&gt; _logger;</div><div class="c-code__line">        <span class="c-code__keyword">private</span> IPipeline _pipeline;</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// The controller has a dependency on IFlowDataProvider. This is used to access the </span></div><div class="c-code__line">        <span class="c-code__comment">// IFlowData that contains the IP Intelligence results for the current HTTP request.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> HomeController(IFlowDataProvider provider, ILogger&lt;HomeController&gt; logger, IPipeline pipeline)</div><div class="c-code__line">        {</div><div class="c-code__line">            _provider = provider;</div><div class="c-code__line">            _logger = logger;</div><div class="c-code__line">            _pipeline = pipeline;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> IActionResult Index()</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Log warnings if the data file is too old or the &#39;Lite&#39; file is being used.</span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span>(_checkedDataFile == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                ExampleUtils.CheckDataFile(_provider.GetFlowData().Pipeline, _logger);</div><div class="c-code__line">                _checkedDataFile = <span class="c-code__keyword">true</span>;</div><div class="c-code__line">            }</div><div class="c-code__line">            <span class="c-code__comment">// Use the provider to get the flow data. This contains the results of</span></div><div class="c-code__line">            <span class="c-code__comment">// IP address lookup that has been performed by the pipeline.</span></div><div class="c-code__line">            var model = <span class="c-code__keyword">new</span> IndexModel(_provider.GetFlowData(), Response.Headers);</div><div class="c-code__line">            <span class="c-code__keywordflow">return</span> View(model);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        [HttpPost]</div><div class="c-code__line">        <span class="c-code__keyword">public</span> IActionResult Index(<span class="c-code__keywordtype">string</span> ipAddress)</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__comment">// Log warnings if the data file is too old or the &#39;Lite&#39; file is being used.</span></div><div class="c-code__line">            <span class="c-code__keywordflow">if</span>(_checkedDataFile == <span class="c-code__keyword">false</span>)</div><div class="c-code__line">            {</div><div class="c-code__line">                ExampleUtils.CheckDataFile(_pipeline, _logger);</div><div class="c-code__line">                _checkedDataFile = <span class="c-code__keyword">true</span>;</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            IFlowData flowData;</div><div class="c-code__line">            </div><div class="c-code__line">            <span class="c-code__keywordflow">if</span> (!<span class="c-code__keywordtype">string</span>.IsNullOrWhiteSpace(ipAddress))</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Create new flow data with custom IP address</span></div><div class="c-code__line">                flowData = _pipeline.CreateFlowData();</div><div class="c-code__line">                flowData.AddEvidence(<span class="c-code__stringliteral">&quot;server.client-ip&quot;</span>, ipAddress);</div><div class="c-code__line">                flowData.Process();</div><div class="c-code__line">            }</div><div class="c-code__line">            <span class="c-code__keywordflow">else</span></div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// Use the default flow data from the current request</span></div><div class="c-code__line">                flowData = _provider.GetFlowData();</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            var model = <span class="c-code__keyword">new</span> IndexModel(flowData, Response.Headers);</div><div class="c-code__line">            model.InputIpAddress = ipAddress;</div><div class="c-code__line">            <span class="c-code__keywordflow">return</span> View(model);</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div><h2>View</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line">@* *********************************************************************</div><div class="c-code__line"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</div><div class="c-code__line"> * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,</div><div class="c-code__line"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</div><div class="c-code__line"> *</div><div class="c-code__line"> * This Original Work is licensed under the European Union Public Licence</div><div class="c-code__line"> * (EUPL) v.1.2 and is subject to its terms as set out below.</div><div class="c-code__line"> *</div><div class="c-code__line"> * If a copy of the EUPL was not distributed with this file, You can obtain</div><div class="c-code__line"> * one at https://opensource.org/licenses/EUPL-1.2.</div><div class="c-code__line"> *</div><div class="c-code__line"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</div><div class="c-code__line"> * amended by the European Commission) shall be deemed incompatible for</div><div class="c-code__line"> * the purposes of the Work and the provisions of the compatibility</div><div class="c-code__line"> * clause in Article 5 of the EUPL shall not apply.</div><div class="c-code__line"> *</div><div class="c-code__line"> * If using the Work as, or as part of, a network application, by</div><div class="c-code__line"> * including the attribution notice(s) required under Article 5 of the EUPL</div><div class="c-code__line"> * in the end user terms of the application under an appropriate heading,</div><div class="c-code__line"> * such notice(s) shall fulfill the requirements of that article.</div><div class="c-code__line"> * ********************************************************************* *@</div><div class="c-code__line"></div><div class="c-code__line">@using FiftyOne.IpIntelligence.Examples</div><div class="c-code__line">@model FiftyOne.IpIntelligence.Examples.OnPremise.GettingStartedWeb.Model.IndexModel</div><div class="c-code__line">@{</div><div class="c-code__line">    ViewData[&quot;Title&quot;] = &quot;IP Intelligence Web Integration Example&quot;;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">&lt;link rel=&quot;stylesheet&quot; href=&quot;~/css/site.css&quot; /&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;h2&gt;IP Intelligence Web Integration Example&lt;/h2&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;p&gt;</div><div class="c-code__line">    This example demonstrates the use of the Pipeline API to perform IP Intelligence lookups within a</div><div class="c-code__line">    simple ASP.NET Core web project.</div><div class="c-code__line">&lt;/p&gt;</div><div class="c-code__line"></div><div class="c-code__line">&lt;noscript&gt;</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: JavaScript is disabled in your browser.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">&lt;/noscript&gt;</div><div class="c-code__line">@if (DateTime.UtcNow &gt; Model.DataFile.DataPublishedDateTime</div><div class="c-code__line">    .AddDays(ExampleUtils.DataFileAgeWarning))</div><div class="c-code__line">{</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: This example is using a data file that is more than </div><div class="c-code__line">        @ExampleUtils.DataFileAgeWarning days old. A more recent data file may be needed to </div><div class="c-code__line">        correctly perform detection. The latest lite data file is available </div><div class="c-code__line">        from the </div><div class="c-code__line">        &lt;a href=&quot;https://github.com/51Degrees/ip-intelligence-data&quot;&gt;ip-intelligence-data&lt;/a&gt;</div><div class="c-code__line">        repository on GitHub. Find out about the Enterprise data file, which includes automatic </div><div class="c-code__line">        daily updates, on our &lt;a href=&quot;https://51degrees.com/pricing&quot;&gt;pricing page&lt;/a&gt;.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line">&lt;div id=&quot;content&quot;&gt;</div><div class="c-code__line">    &lt;h3&gt;IP Intelligence Lookup&lt;/h3&gt;</div><div class="c-code__line">    &lt;form method=&quot;post&quot; asp-action=&quot;Index&quot;&gt;</div><div class="c-code__line">        &lt;div style=&quot;margin-bottom: 20px;&quot;&gt;</div><div class="c-code__line">            &lt;label for=&quot;ipAddress&quot;&gt;Enter IP Address:&lt;/label&gt;</div><div class="c-code__line">            &lt;input type=&quot;text&quot; id=&quot;ipAddress&quot; name=&quot;ipAddress&quot; value=&quot;@Model.InputIpAddress&quot; </div><div class="c-code__line">                   placeholder=&quot;e.g., 116.154.188.222&quot; style=&quot;margin-left: 10px; padding: 5px;&quot;&gt;</div><div class="c-code__line">            &lt;button type=&quot;submit&quot; style=&quot;margin-left: 10px; padding: 5px 15px;&quot;&gt;Look Up&lt;/button&gt;</div><div class="c-code__line">        &lt;/div&gt;</div><div class="c-code__line">    &lt;/form&gt;</div><div class="c-code__line">    </div><div class="c-code__line">    &lt;h3&gt;Detection results&lt;/h3&gt;</div><div class="c-code__line">    &lt;p&gt;</div><div class="c-code__line">        The following values are determined by IP Intelligence analysis:</div><div class="c-code__line">    &lt;/p&gt;</div><div class="c-code__line">    &lt;table&gt;</div><div class="c-code__line">        &lt;tr&gt;</div><div class="c-code__line">            &lt;th&gt;Property&lt;/th&gt;</div><div class="c-code__line">            &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">        &lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Registered Name:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.Name&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;Registered Owner:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.RegisteredOwner&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Registered Country:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.RegisteredCountry&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;IP Range Start:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.IpRangeStart&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;IP Range End:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.IpRangeEnd&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;Country:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.Country&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Country Code:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.CountryCode&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;Country Code 3:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.CountryCode3&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Region:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.Region&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;State:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.State&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Town:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.Town&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;Latitude:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.Latitude&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Longitude:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.Longitude&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;Areas:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.Areas&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightyellow&quot;&gt;&lt;td&gt;&lt;b&gt;Accuracy Radius:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.AccuracyRadius&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">        &lt;tr class=&quot;lightgreen&quot;&gt;&lt;td&gt;&lt;b&gt;Time Zone Offset:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;@Model.TimeZoneOffset&lt;/td&gt;&lt;/tr&gt;</div><div class="c-code__line">    &lt;/table&gt;</div><div class="c-code__line">    &lt;br /&gt;</div><div class="c-code__line"></div><div class="c-code__line">    &lt;div id=&quot;evidence&quot;&gt;</div><div class="c-code__line">        &lt;h3&gt;Evidence used&lt;/h3&gt;</div><div class="c-code__line">        &lt;p class=&quot;smaller&quot;&gt;Evidence was &lt;span class=&quot;lightgreen&quot;&gt;used&lt;/span&gt; / &lt;span class=&quot;lightyellow&quot;&gt;present&lt;/span&gt; for detection&lt;/p&gt;</div><div class="c-code__line">        &lt;table&gt;</div><div class="c-code__line">            &lt;tr&gt;</div><div class="c-code__line">                &lt;th&gt;Key&lt;/th&gt;</div><div class="c-code__line">                &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">            &lt;/tr&gt;</div><div class="c-code__line">            @foreach (var entry in Model.Evidence.Where(e =&gt; e.Key.Equals(&quot;server.client-ip&quot;, StringComparison.OrdinalIgnoreCase)))</div><div class="c-code__line">            {</div><div class="c-code__line">                &lt;tr class=&quot;@(entry.Used ? &quot;lightgreen&quot; : &quot;lightyellow&quot;)&quot;&gt;</div><div class="c-code__line">                    &lt;td&gt;&lt;b&gt;@(entry.Key)&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                    &lt;td&gt;@(entry.Value)&lt;/td&gt;</div><div class="c-code__line">                &lt;/tr&gt;</div><div class="c-code__line">            }</div><div class="c-code__line">        &lt;/table&gt;</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">    &lt;br /&gt;</div><div class="c-code__line"></div><div class="c-code__line">    &lt;div id=&quot;response-headers&quot;&gt;</div><div class="c-code__line">        &lt;h3&gt;Response headers&lt;/h3&gt;</div><div class="c-code__line">        &lt;table&gt;</div><div class="c-code__line">            &lt;tr&gt;</div><div class="c-code__line">                &lt;th&gt;Key&lt;/th&gt;</div><div class="c-code__line">                &lt;th&gt;Value&lt;/th&gt;</div><div class="c-code__line">            &lt;/tr&gt;</div><div class="c-code__line">            @foreach (var entry in Model.ResponseHeaders)</div><div class="c-code__line">            {</div><div class="c-code__line">            &lt;tr class=&quot;lightyellow&quot;&gt;</div><div class="c-code__line">                &lt;td&gt;&lt;b&gt;@(entry.Key)&lt;/b&gt;&lt;/td&gt;</div><div class="c-code__line">                &lt;td&gt;@(entry.Value)&lt;/td&gt;</div><div class="c-code__line">            &lt;/tr&gt;</div><div class="c-code__line">            }</div><div class="c-code__line">        &lt;/table&gt;</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">    &lt;br /&gt;</div><div class="c-code__line">    @if (Model.Engine.DataSourceTier == &quot;Lite&quot;)</div><div class="c-code__line">    {</div><div class="c-code__line">    &lt;div class=&quot;example-alert&quot;&gt;</div><div class="c-code__line">        WARNING: You are using the free &#39;Lite&#39; data file. Find out about the Enterprise data file on our</div><div class="c-code__line">        &lt;a href=&quot;https://51degrees.com/pricing&quot;&gt;pricing page&lt;/a&gt;.</div><div class="c-code__line">    &lt;/div&gt;</div><div class="c-code__line">    }</div><div class="c-code__line">&lt;/div&gt;</div><div class="c-code__line"></div></div><h2>Startup</h2>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2025 51 Degrees Mobile Experts Limited, Davidson House,</span></div><div class="c-code__line"><span class="c-code__comment"> * Forbury Square, Reading, Berkshire, United Kingdom RG1 3EU.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Original Work is licensed under the European Union Public Licence</span></div><div class="c-code__line"><span class="c-code__comment"> * (EUPL) v.1.2 and is subject to its terms as set out below.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the EUPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at https://opensource.org/licenses/EUPL-1.2.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * The &#39;Compatible Licences&#39; set out in the Appendix to the EUPL (as may be</span></div><div class="c-code__line"><span class="c-code__comment"> * amended by the European Commission) shall be deemed incompatible for</span></div><div class="c-code__line"><span class="c-code__comment"> * the purposes of the Work and the provisions of the compatibility</span></div><div class="c-code__line"><span class="c-code__comment"> * clause in Article 5 of the EUPL shall not apply.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If using the Work as, or as part of, a network application, by</span></div><div class="c-code__line"><span class="c-code__comment"> * including the attribution notice(s) required under Article 5 of the EUPL</span></div><div class="c-code__line"><span class="c-code__comment"> * in the end user terms of the application under an appropriate heading,</span></div><div class="c-code__line"><span class="c-code__comment"> * such notice(s) shall fulfill the requirements of that article.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">using</span> <a class="code" href="namespace_fifty_one.html">FiftyOne</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence.html">IpIntelligence</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_engine.html">Engine</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_engine_1_1_on_premise.html">OnPremise</a>.<a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_engine_1_1_on_premise_1_1_flow_elements.html">FlowElements</a>;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Builder;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Hosting;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.AspNetCore.Http;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.Configuration;</div><div class="c-code__line"><span class="c-code__keyword">using</span> Microsoft.Extensions.DependencyInjection;</div><div class="c-code__line"><span class="c-code__keyword">using</span> System.Threading.Tasks;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">namespace </span><a class="code" href="namespace_fifty_one_1_1_ip_intelligence_1_1_examples_1_1_on_premise_1_1_getting_started_web.html">FiftyOne.IpIntelligence.Examples.OnPremise.GettingStartedWeb</a></div><div class="c-code__line">{</div><div class="c-code__line">    <span class="c-code__keyword">public</span> <span class="c-code__keyword">class </span>Startup</div><div class="c-code__line">    {</div><div class="c-code__line">        <span class="c-code__keyword">public</span> Startup(IConfiguration configuration)</div><div class="c-code__line">        {</div><div class="c-code__line">            Configuration = configuration;</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">public</span> IConfiguration Configuration { <span class="c-code__keyword">get</span>; }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// This method gets called by the runtime. Use this method to add services to the container.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> ConfigureServices(IServiceCollection services)</div><div class="c-code__line">        {</div><div class="c-code__line">            services.AddControllersWithViews();</div><div class="c-code__line"></div><div class="c-code__line">            services.Configure&lt;CookiePolicyOptions&gt;(options =&gt;</div><div class="c-code__line">            {</div><div class="c-code__line">                <span class="c-code__comment">// This lambda determines whether user consent for non-essential cookies is needed</span></div><div class="c-code__line">                <span class="c-code__comment">// for a given request.</span></div><div class="c-code__line">                options.CheckConsentNeeded = context =&gt; <span class="c-code__keyword">true</span>;</div><div class="c-code__line">                options.MinimumSameSitePolicy = SameSiteMode.None;</div><div class="c-code__line">            });</div><div class="c-code__line"></div><div class="c-code__line">            services.AddMvc();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Add the hash engine builder to services so that the system can find the builder</span></div><div class="c-code__line">            <span class="c-code__comment">// when it needs to.</span></div><div class="c-code__line">            services.AddSingleton&lt;IpiOnPremiseEngineBuilder&gt;();</div><div class="c-code__line">            <span class="c-code__comment">// Configure the services needed by IP Intelligence and create the 51Degrees Pipeline</span></div><div class="c-code__line">            <span class="c-code__comment">// instance that will be used to process requests.</span></div><div class="c-code__line">            services.AddFiftyOne(Configuration);</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// This method gets called by the runtime. Use this method to configure the HTTP request</span></div><div class="c-code__line">        <span class="c-code__comment">// pipeline.</span></div><div class="c-code__line">        <span class="c-code__keyword">public</span> <span class="c-code__keywordtype">void</span> Configure(IApplicationBuilder app, IWebHostEnvironment env)</div><div class="c-code__line">        {</div><div class="c-code__line">            app.UseDeveloperExceptionPage();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// This is only needed when running under an ASP.NET test server.</span></div><div class="c-code__line">            app.UseMiddleware&lt;UserAgentCorrectionMiddleware&gt;();</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Add the 51Degrees middleware component.</span></div><div class="c-code__line">            <span class="c-code__comment">// This will pass any incoming requests through the pipeline API, performing IP Intelligence</span></div><div class="c-code__line">            <span class="c-code__comment">// The IFlowData that is used will be stored in the data associated with </span></div><div class="c-code__line">            <span class="c-code__comment">// the current HTTP session.</span></div><div class="c-code__line">            <span class="c-code__comment">// The IFlowDataAccessor provides an easy way to retrieve this data. See HomeController</span></div><div class="c-code__line">            <span class="c-code__comment">// for an example of this.</span></div><div class="c-code__line">            app.UseFiftyOne();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseStaticFiles();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseRouting();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseAuthorization();</div><div class="c-code__line"></div><div class="c-code__line">            app.UseEndpoints(endpoints =&gt;</div><div class="c-code__line">            {</div><div class="c-code__line">                endpoints.MapControllerRoute(</div><div class="c-code__line">                    name: <span class="c-code__stringliteral">&quot;default&quot;</span>,</div><div class="c-code__line">                    pattern: <span class="c-code__stringliteral">&quot;{controller=Home}/{action=Index}/{id?}&quot;</span>);</div><div class="c-code__line">            });</div><div class="c-code__line">        }</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__keyword">private</span> <span class="c-code__keyword">class </span>UserAgentCorrectionMiddleware</div><div class="c-code__line">        {</div><div class="c-code__line">            <span class="c-code__keyword">private</span> readonly RequestDelegate next;</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> UserAgentCorrectionMiddleware(RequestDelegate next)</div><div class="c-code__line">            {</div><div class="c-code__line">                this.next = next;</div><div class="c-code__line">            }</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__keyword">public</span> async Task Invoke(HttpContext httpContext)</div><div class="c-code__line">            {</div><div class="c-code__line">                var val = httpContext.Request.Headers[<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>];</div><div class="c-code__line">                httpContext.Request.Headers.Remove(<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>);</div><div class="c-code__line">                httpContext.Request.Headers[<span class="c-code__stringliteral">&quot;User-Agent&quot;</span>] =</div><div class="c-code__line">                    <span class="c-code__keyword">new</span> Microsoft.Extensions.Primitives.StringValues(<span class="c-code__keywordtype">string</span>.Join(<span class="c-code__stringliteral">&quot; &quot;</span>, val));</div><div class="c-code__line">                await this.next(httpContext);</div><div class="c-code__line">            }</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">}</div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
